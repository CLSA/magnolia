<div class="utility-view rounded" style="padding-bottom: 2em;" ng-show="!isComplete || model.viewModel.isLoading">
  <cn-loading></cn-loading>
</div>
<div class="utility-view rounded" ng-show="isComplete && !model.viewModel.isLoading">
  <div class="container-fluid bg-primary rounded-top">
    <h4>
      <button class="btn btn-menu btn-header btn-info pull-right"
              style="margin-top:-4px;"
              ng-click="model.viewModel.toggleLanguage()">
        {{ 'en'==model.viewModel.record.lang ? 'Version française' : 'English Version' }}
      </button>
      <span ng-bind-html="getHeading()"></span>
    </h4>
  </div>
  <div class="form-footer text-right bg-info" style="height:4.6em;">
    <div class="btn-group">
      <div class="btn-group dropdown">
        <button type="button"
                class="btn btn-default dropdown-toggle"
                id="downloadForms"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
                ng-bind-html="t( 'misc.download' ) + ' <span class=\'caret\' ng-if=\'op.operations\'></span>'"></button>
        <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="downloadForms">
          <li><a ng-click="model.viewModel.downloadApplication()" ng-bind-html="t( 'misc.application' )"></a></li>
          <li><a ng-click="model.viewModel.downloadChecklist()" ng-bind-html="t( 'misc.dataChecklist' )"></a></li>
          <li>
            <a ng-click="model.viewModel.downloadApplicationAndChecklist()"
               ng-bind-html="t( 'misc.applicationAndDataChecklist' )"></a>
          </li>
          <li ng-class="!liteModel.viewModel.record.data_sharing_filename ? 'disabled' : ''">
            <a ng-click="!liteModel.viewModel.record.data_sharing_filename ?
                         $event.stopPropagation() :
                         model.viewModel.downloadDataSharing()"
               ng-bind-html="t( 'misc.dataSharing' )"></a>
          </li>
          <li><a ng-click="model.viewModel.displayNotices()" ng-bind-html="t( 'misc.notices' )"></a></li>
          <li ng-if="model.viewModel.canViewData()">
            <a ng-click="model.viewModel.viewData()" ng-bind-html="t( 'misc.studyData' )"></a>
          </li>
        </ul>
      </div>
      <div class="btn-group dropdown">
        <button type="button"
                class="btn btn-default dropdown-toggle"
                id="switchForms"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
                ng-if="0 < model.viewModel.formList.length"
                ng-bind-html="t( 'misc.switchForm' ) + ' <span class=\'caret\' ng-if=\'op.operations\'></span>'"></button>
        <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="switchForms">
          <li ng-repeat="form in model.viewModel.formList">
            <a ng-click="model.viewModel.transitionTo(form.name)" ng-bind-html="t('misc.'+form.title)"></a>
          </li>
        </ul>
      </div>
      <div class="btn-group dropdown" ng-if="model.viewModel.show( 'compare' ) && 1 < model.viewModel.versionList.length">
        <button type="button"
                class="btn btn-info dropdown-toggle"
                id="versionList"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false">
          Compare {{ null == model.viewModel.compareRecord ? '' : 'Version ' + model.viewModel.compareRecord.amendment_version }}
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu full-width" aria-labelledby="versionList">
          <li ng-repeat="version in model.viewModel.versionList">
            <a ng-if="version.id != model.viewModel.record.id && model.viewModel.compareRecord != version"
               ng-click="compareTo( version )">
              {{ null == version ? 'none' : 'Version ' + version.amendment_version }}
            </a>
          </li>
        </ul>
      </div>
      <button class="btn btn-primary"
              ng-if="model.viewModel.show( 'view' )"
              ng-click="model.viewModel.transitionTo('reqn')"
              type="button">Show Record</button>
      <button class="btn btn-success"
              ng-if="model.viewModel.show( 'submit' )"
              ng-click="model.viewModel.submit()"
              ng-bind-html="t( 'misc.submit' )"
              type="button"></button>
      <button class="btn btn-warning"
              ng-if="model.viewModel.show( 'amend' )"
              ng-click="model.viewModel.amend()"
              ng-bind-html="t( 'misc.amend' )"
              type="button"></button>
    </div>
    <div class="btn-group pull-left">
      <button class="btn btn-danger"
              ng-if="model.viewModel.show( 'delete' )"
              ng-click="model.viewModel.delete()"
              ng-bind-html="t( 'misc.delete' )"
              type="button"></button>
      <button class="btn btn-danger"
              ng-if="model.viewModel.show( 'abandon' )"
              ng-click="model.viewModel.abandon()"
              ng-bind-html="t( 'misc.abandon' )"
              type="button"></button>
    </div>
  </div>
  <div class="container-fluid" style="padding-top: 1em;">
    <div ng-if="model.viewModel.record.show_prices"
         class="spacer pull-right text-info"
         ng-bind-html="t( 'misc.totalCost' ) + ': ' + model.viewModel.calculateCost()">
    </div>
    <ul class="nav nav-tabs">
      <li ng-class="{'active':'instructions'==model.viewModel.formTab}">
        <a ng-click="model.viewModel.setFormTab('instructions')"
           ng-class="{
             'text-warning flashing':
               model.getEditEnabled() && model.viewModel.record.deferral_note_instructions,
             'bg-warning': model.viewModel.compareRecord.differences.instructions.diff
           }"
           ng-bind-html="t( 'instructions.tab' )"></a>
      </li>
      <li ng-class="{'active':'part1' == modelviewModel.getTabPart()}">
        <a ng-click="model.viewModel.setFormTab('applicant')"
           ng-class="{
             'text-warning flashing':
               model.getEditEnabled() && (
                 model.viewModel.record.deferral_note_applicant ||
                 model.viewModel.record.deferral_note_project_team ||
                 model.viewModel.record.deferral_note_timeline ||
                 model.viewModel.record.deferral_note_description ||
                 model.viewModel.record.deferral_note_scientific_review ||
                 model.viewModel.record.deferral_note_ethics
               ),
             'bg-warning': model.viewModel.compareRecord.differences.part1.diff
           }"
           ng-bind-html="t( 'part1.tab' )"></a>
      </li>
      <li ng-class="{ 'active': 'part2' == model.viewModel.getTabPart() }">
        <a ng-click="model.viewModel.setFormTab('notes')"
           ng-class="{
             'text-warning flashing': model.getEditEnabled() && (
               model.viewModel.record.deferral_note_notes ||
               model.viewModel.record.deferral_note_cohort ||
               model.viewModel.record.deferral_note_indigenous ||
               model.viewModel.record.deferral_note_data_core_clsa_data ||
               model.viewModel.record.deferral_note_data_linked_data ||
               model.viewModel.record.deferral_note_data_images_and_raw_data ||
               model.viewModel.record.deferral_note_data_geographic_indicators ||
               model.viewModel.record.deferral_note_data_covid_19_data ||
               model.viewModel.record.deferral_note_data_mortality_data
             ),
             'bg-warning': model.viewModel.compareRecord.differences.part2.diff
           }"
           ng-bind-html="t( 'part2.tab' )"></a>
      </li>
      <li ng-class="{'active':'part3' == model.viewModel.getTabPart()}">
        <a ng-click="model.viewModel.setFormTab('biospecimen_access')"
           ng-class="{
             'text-warning flashing':
               model.getEditEnabled() && model.viewModel.record.deferral_note_biospecimen_access,
             'bg-warning': model.viewModel.compareRecord.differences.part3.diff
           }"
           ng-bind-html="t( 'part3.tab' )"></a>
      </li>
      <li ng-class="{'active':'manuscripts' == model.viewModel.getTabPart()}" ng-if="model.viewModel.showManuscripts()">
        <a ng-click="model.viewModel.setFormTab('manuscripts')" ng-bind-html="t( 'manuscripts.tab' )"></a>
      </li>
      <li ng-class="{'active':'agreement' == model.viewModel.getTabPart()}" ng-if="model.viewModel.showAgreement()">
        <a ng-click="model.viewModel.setFormTab('agreement')">Agreement</a>
      </li>
    </ul>
    <div ng-show="'instructions'==model.viewModel.formTab" class="panel panel-default" style="border-top-left-radius: 0px;">
      <div class="panel-body" style="padding-bottom: 0px;" ng-if="'.' == model.viewModel.record.amendment">
        <h4 ng-bind-html="t( 'instructions.title' )"></h4>
        <ul class="list-group">
          <li class="list-group-item" ng-bind-html="t( 'instructions.text1' )"></li>
          <li class="list-group-item" ng-bind-html="t( 'instructions.text2' )"></li>
          <li class="list-group-item" ng-bind-html="t( 'instructions.text3' )"></li>
          <li class="list-group-item" ng-bind-html="t( 'instructions.text4' )"></li>
          <li class="list-group-item" ng-bind-html="t( 'instructions.text5' )"></li>
          <li class="list-group-item" ng-bind-html="t( 'instructions.text6' )"></li>
        </ul>
      </div>
      <div class="panel-body" style="padding-bottom: 0px;" ng-if="'.' != model.viewModel.record.amendment">
        <h4 style="margin-top: 0; margin-bottom: 1em;" ng-bind-html="t( 'amendment.title' )"></h4>
        <cn-deferral-note ng-if="model.getEditEnabled()" page="instructions" class="bg-info"></cn-deferral-note>
        <ul class="list-group">
          <li class="list-group-item" ng-bind-html="t( 'amendment.text1' )"></li>
          <li class="list-group-item" ng-bind-html="t( 'amendment.text2' )"></li>
        </ul>
        <form id="amendment_form" name="amendment_form" novalidate><fieldset ng-disabled="!model.getEditEnabled() || isDAO()">
          <p class="text-primary" ng-bind-html="t( 'amendment.text3' )"></p>
          <div class="input-group spacer"
               ng-class="{'has-feedback has-error':model.viewModel.noAmendmentTypes}"
               style="padding: 0 0.5em">
            <div ng-repeat="amendmentType in model.amendmentTypeList[model.viewModel.record.lang]">
              <div style="margin: 0;"
                   class="row"
                   ng-class="{
                     'bg-warning': model.viewModel.compareRecord.differences.instructions.amendments['amendmentType'+amendmentType.id]
                   }">
                <input type="checkbox"
                       id="amendmentType{{ amendmentType.id }}"
                       ng-model="model.viewModel.record['amendmentType'+amendmentType.id]"
                       ng-change="model.viewModel.toggleAmendmentTypeValue( amendmentType.id )"></input>
                <label for="amendmentType{{ amendmentType.id }}" class="control-label" ng-bind-html="amendmentType.name"></label>
                <cn-view-input-with-differences
                  ng-if="amendmentType.newUser && model.viewModel.record['amendmentType'+amendmentType.id]"
                  no-cols=true
                  input="{
                    key: 'new_user_id',
                    title: t( 'amendment.newUser' ),
                    type: model.inputList.new_user_id.type,
                    typeahead: model.inputList.new_user_id.typeahead
                  }"
                  model="model">
                </cn-view-input-with-differences>
              </div>
              <div style="padding: 0 2em;"
                   ng-class="{
                     'bg-warning': model.viewModel.compareRecord.differences.instructions.amendments['amendmentType'+amendmentType.id]
                   }"
                   ng-if="amendmentType.justificationPrompt && model.viewModel.record['amendmentType'+amendmentType.id]">
                <span class="text-info" ng-bind-html="amendmentType.justificationPrompt"></span>
                <cn-view-input-with-differences
                  no-cols=true
                  input="{
                    key: 'amendment_justification_' + amendmentType.id,
                    title: t( 'amendment.justification' ) + '<br><span class=text-info>(' +
                           model.viewModel.charCount.amendment_justification_list['amendment_justification_' + amendmentType.id] + ' ' + t( 'misc.chars' ) + ')</span>',
                    type: 'text',
                    isConstant: isDAO,
                    maxLength: 2500
                  }"
                  difference="model.viewModel.compareRecord.differences.instructions.amendments.amendmentJustificationList.findByProperty( 'id', amendmentType.id )"
                  model="model">
                </cn-view-input-with-differences>
              </div>
            </div>
            <span ng-if="model.viewModel.noAmendmentTypes" class="help-block" ng-bind-html="t( 'amendment.atLeastOne' )"></span>
          </div>
        </fieldset></form>
      </div>
    </div>
    <div ng-show="'part1'==model.viewModel.getTabPart()" class="panel panel-default">
      <div class="panel-body" style="padding-bottom: 0px;">
        <h4 style="margin-top: 0; margin-bottom: 1em;" ng-bind-html="t( 'part1.title' )"></h4>
        <ul class="nav nav-tabs">
          <li ng-repeat="tab in model.viewModel.tabList"
              ng-if="'part1' == model.viewModel.getTabPart(tab)"
              ng-class="{'active':tab == model.viewModel.formTab}">
            <a ng-click="model.viewModel.setFormTab(tab)"
               ng-class="{
                 'text-warning flashing':model.getEditEnabled() && model.viewModel.record['deferral_note_'+tab],
                 'bg-warning': model.viewModel.compareRecord.differences.part1[tab].diff
               }"
               ng-bind-html="t( 'part1.'+tab+'.tab' )"></a>
          </li>
        </ul>
        <div
          ng-show="'applicant'==model.viewModel.formTab"
          class="panel panel-default"
          style="border-top-left-radius: 0px;"
        >
          <div class="panel-body">
            <cn-deferral-note ng-if="model.getEditEnabled()" page="applicant" class="bg-info"></cn-deferral-note>
            <p class="text-primary" ng-bind-html="t( 'part1.applicant.text1' )"></p>
            <p class="text-primary" ng-bind-html="t( 'part1.applicant.text2' )"></p>
            <p class="text-primary" ng-bind-html="'<strong>'+t( 'misc.emailText' )+'</strong>'"></p>
            <hr/>
            <form id="applicant_form" name="applicant_form" novalidate><fieldset ng-disabled="!model.getEditEnabled() || isDAO()">
              <div class="form-horizontal">
                <cn-view-input-with-differences
                  input="{
                    key: 'applicant_name',
                    title: t( 'part1.applicant.applicant_name' ),
                    type: model.inputList.applicant_name.type,
                    constant: true
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.applicant.applicant_name"
                  model="model">
                </cn-view-input-with-differences>
                <cn-view-input-with-differences
                  input="{
                    key: 'applicant_position',
                    title: t( 'part1.applicant.applicant_position' ),
                    type: model.inputList.applicant_position.type
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.applicant.applicant_position"
                  model="model">
                </cn-view-input-with-differences>
                <cn-view-input-with-differences
                  input="{
                    key: 'applicant_affiliation',
                    title: t( 'part1.applicant.applicant_affiliation' ),
                    type: model.inputList.applicant_affiliation.type
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.applicant.applicant_affiliation"
                  model="model">
                </cn-view-input-with-differences>
                <cn-view-input-with-differences
                  input="{
                    key: 'applicant_country_id',
                    title: t( 'part1.applicant.applicant_country_id' ),
                    type: model.inputList.applicant_country_id.type,
                    typeahead: model.inputList.applicant_country_id.typeahead
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.applicant.applicant_country_id"
                  model="model">
                </cn-view-input-with-differences>
                <cn-view-input-with-differences
                  input="{
                    key: 'applicant_address',
                    title: t( 'part1.applicant.applicant_address' ),
                    type: model.inputList.applicant_address.type
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.applicant.applicant_address"
                  model="model">
                </cn-view-input-with-differences>
                <cn-view-input-with-differences
                  input="{
                    key: 'applicant_phone',
                    title: t( 'part1.applicant.applicant_phone' ),
                    type: model.inputList.applicant_phone.type
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.applicant.applicant_phone"
                  model="model">
                </cn-view-input-with-differences>
                <cn-view-input-with-differences
                  input="{
                    key: 'applicant_email',
                    title: t( 'part1.applicant.applicant_email' ),
                    type: model.inputList.applicant_email.type,
                    constant: true,
                    help: t( 'misc.emailText' )
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.applicant.applicant_email"
                  model="model">
                </cn-view-input-with-differences>
              </div>
              <hr />
              <p class="text-primary" ng-bind-html="t( 'part1.applicant.text3' )"></p>
              <div class="form-horizontal">
                <cn-view-input-with-differences
                  input="{
                    key: 'trainee_name',
                    title: t( 'part1.applicant.trainee_name' ),
                    type: model.inputList.trainee_name.type,
                    constant: true
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.applicant.trainee_name"
                  model="model">
                </cn-view-input-with-differences>
                <cn-view-input-with-differences
                  input="{
                    key: 'trainee_program',
                    title: t( 'part1.applicant.trainee_program' ),
                    type: model.inputList.trainee_program.type,
                    constant: !model.viewModel.record.trainee_name
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.applicant.trainee_program"
                  model="model">
                </cn-view-input-with-differences>
                <cn-view-input-with-differences
                  input="{
                    key: 'trainee_institution',
                    title: t( 'part1.applicant.trainee_institution' ),
                    type: 'string',
                    constant: !model.viewModel.record.trainee_name
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.applicant.trainee_institution"
                  model="model">
                </cn-view-input-with-differences>
                <cn-view-input-with-differences
                  input="{
                    key: 'trainee_country_id',
                    title: t( 'part1.applicant.trainee_country_id' ),
                    type: model.inputList.trainee_country_id.type,
                    typeahead: model.inputList.trainee_country_id.typeahead,
                    constant: !model.viewModel.record.trainee_name
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.applicant.trainee_country_id"
                  model="model">
                </cn-view-input-with-differences>
                <cn-view-input-with-differences
                  input="{
                    key: 'trainee_address',
                    title: t( 'part1.applicant.trainee_address' ),
                    type: model.inputList.trainee_address.type,
                    constant: !model.viewModel.record.trainee_name
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.applicant.trainee_address"
                  model="model">
                </cn-view-input-with-differences>
                <cn-view-input-with-differences
                  input="{
                    key: 'trainee_phone',
                    title: t( 'part1.applicant.trainee_phone' ),
                    type: model.inputList.trainee_phone.type,
                    constant: !model.viewModel.record.trainee_name
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.applicant.trainee_phone"
                  model="model">
                </cn-view-input-with-differences>
                <cn-view-input-with-differences
                  input="{
                    key: 'trainee_email',
                    title: t( 'part1.applicant.trainee_email' ),
                    type: model.inputList.trainee_email.type,
                    constant: true,
                    help: t( 'misc.emailText' )
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.applicant.trainee_email"
                  model="model">
                </cn-view-input-with-differences>
              </div>
              <hr />
              <p class="text-primary" ng-bind-html="t( 'part1.applicant.text4' )"></p>
              <div class="form-horizontal">
                <cn-view-input-with-differences
                  input="{
                    key: 'waiver',
                    title: t( 'part1.applicant.waiver' ),
                    type: 'enum',
                    enumList: model.metadata.columnList.waiver.enumList[model.viewModel.record.lang],
                    constant: !model.viewModel.isWaiverAllowed() || !model.viewModel.isWaiverMutable()
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.applicant.waiver"
                  model="model">
                </cn-view-input-with-differences>
              </div>
            </fieldset></form>
          </div>
        </div>
        <div ng-show="'project_team'==model.viewModel.formTab" class="panel panel-default">
          <div class="panel-body">
            <cn-deferral-note ng-if="model.getEditEnabled()" page="project_team"></cn-deferral-note>
            <p class="text-primary" ng-bind-html="t( 'part1.project_team.text' )"></p>
            <p class="text-primary" ng-bind-html="'<strong>'+t( 'misc.emailText' )+'</strong>'"></p>
            <div class="panel panel-default">
              <div class="panel-body"
                   ng-class="{ 'bg-warning': 0 < model.viewModel.compareRecord.differences.part1.project_team.coapplicantList.length }">
                <h4 ng-if="0 < model.viewModel.compareRecord.differences.part1.project_team.coapplicantList.length">Current Version List</h4>
                <span ng-show="0 == model.viewModel.record.coapplicantList.length"
                      ng-bind-html="t( 'part1.project_team.noCoapplicants' )"></span>
                <table class="table table-striped"
                       ng-class="{ 'table-hover': model.getEditEnabled() && !isDAO() }"
                       ng-show="0 < model.viewModel.record.coapplicantList.length">
                  <thead class="bg-info">
                    <tr>
                      <td ng-bind-html="t( 'part1.project_team.name' )"></td>
                      <td ng-bind-html="t( 'part1.project_team.position' )"></td>
                      <td ng-bind-html="t( 'part1.project_team.affiliation' )"></td>
                      <td ng-bind-html="t( 'part1.project_team.country' )"></td>
                      <td ng-bind-html="t( 'part1.project_team.email' )"></td>
                      <td ng-bind-html="t( 'part1.project_team.role' )"></td>
                      <td ng-bind-html="t( 'part1.project_team.access' )"></td>
                      <td ng-show="model.getEditEnabled() && !isDAO()"></td>
                    </tr>
                  </thead>
                  <tbody>
                    <tr ng-repeat="coapplicant in model.viewModel.record.coapplicantList"
                        ng-click="model.getEditEnabled() && !isDAO() && editCoapplicant( coapplicant.id )">
                      <td>{{ coapplicant.name }}</td>
                      <td>{{ coapplicant.position }}</td>
                      <td>{{ coapplicant.affiliation }}</td>
                      <td>{{ coapplicant.country }}</td>
                      <td>{{ coapplicant.email }}</td>
                      <td>{{ coapplicant.role }}</td>
                      <td>{{ coapplicant.access ? 'Yes' : 'No' }}</td>
                      <td ng-show="model.getEditEnabled() && !isDAO()">
                        <button class="btn btn-xs btn-danger"
                                ng-disabled="isDeletingCoapplicant.includes( coapplicant.id )"
                                ng-click="removeCoapplicant( coapplicant.id ) && $event.stopPropagation()"
                                uib-tooltip-html="t( 'misc.remove' )">
                          <i class="glyphicon glyphicon-remove"></i>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <div ng-if="0 < model.viewModel.compareRecord.differences.part1.project_team.coapplicantList.length">
                  <hr style="border-top-color: gray;"/>
                  <h4>Version {{ model.viewModel.compareRecord.amendment_version }} List</h4>
                  <span ng-show="0 == model.viewModel.compareRecord.coapplicantList.length"
                        ng-bind-html="t( 'part1.project_team.noCoapplicants' )"></span>
                  <table class="table table-striped" ng-show="0 < model.viewModel.compareRecord.coapplicantList.length">
                    <thead class="bg-info">
                      <tr>
                        <td ng-bind-html="t( 'part1.project_team.name' )"></td>
                        <td ng-bind-html="t( 'part1.project_team.position' )"></td>
                        <td ng-bind-html="t( 'part1.project_team.affiliation' )"></td>
                        <td ng-bind-html="t( 'part1.project_team.country' )"></td>
                        <td ng-bind-html="t( 'part1.project_team.email' )"></td>
                        <td ng-bind-html="t( 'part1.project_team.role' )"></td>
                        <td ng-bind-html="t( 'part1.project_team.access' )"></td>
                      </tr>
                    </thead>
                    <tbody>
                      <tr ng-repeat="coapplicant in model.viewModel.compareRecord.coapplicantList">
                        <td>{{ coapplicant.name }}</td>
                        <td>{{ coapplicant.position }}</td>
                        <td>{{ coapplicant.affiliation }}</td>
                        <td>{{ coapplicant.country }}</td>
                        <td>{{ coapplicant.email }}</td>
                        <td>{{ coapplicant.role }}</td>
                        <td>{{ coapplicant.access ? 'Yes' : 'No' }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <form
              id="project_team_form"
              name="project_team_form"
              ng-show="model.getEditEnabled() && !isDAO()"
              novalidate
            >
              <fieldset ng-disabled="!model.getEditEnabled() && !isDAO()">
                <div class="form-horizontal">
                  <cn-add-input
                    input="{ key: 'name', title: t( 'part1.project_team.name' ), type: 'string' }"
                    record="coapplicantRecord"
                    model="model.viewModel.coapplicantModel"
                    first="true">
                  </cn-add-input>
                  <cn-add-input
                    input="{ key: 'position', title: t( 'part1.project_team.position' ), type: 'string' }"
                    record="coapplicantRecord"
                    model="model.viewModel.coapplicantModel"
                    first="false">
                  </cn-add-input>
                  <cn-add-input
                    input="{ key: 'affiliation', title: t( 'part1.project_team.affiliation' ), type: 'string' }"
                    record="coapplicantRecord"
                    model="model.viewModel.coapplicantModel"
                    first="false">
                  </cn-add-input>
                  <cn-add-input
                    input="{
                      key: 'country_id',
                      title: t( 'part1.project_team.country' ),
                      type: 'lookup-typeahead',
                      typeahead: model.inputList.applicant_country_id.typeahead
                    }"
                    record="coapplicantRecord"
                    formatted-record="coapplicantFormattedRecord"
                    model="model.viewModel.coapplicantModel"
                    first="false">
                  </cn-add-input>
                  <cn-add-input
                    input="{
                      key: 'email',
                      title: t( 'part1.project_team.email' ),
                      type: 'string',
                      help: t( 'misc.emailText' )
                    }"
                    record="coapplicantRecord"
                    model="model.viewModel.coapplicantModel"
                    first="false">
                  </cn-add-input>
                  <cn-add-input
                    input="{ key: 'role', title: t( 'part1.project_team.role' ), type: 'string' }"
                    record="coapplicantRecord"
                    model="model.viewModel.coapplicantModel"
                    first="false">
                  </cn-add-input>
                  <cn-add-input
                    input="{
                      key: 'access',
                      title: t( 'part1.project_team.access' ),
                      type: 'boolean',
                      enumList: model.metadata.accessEnumList[model.viewModel.record.lang]
                    }"
                    record="coapplicantRecord"
                    model="model.viewModel.coapplicantModel"
                    first="false">
                  </cn-add-input>
                  <button class="btn btn-primary pull-right"
                          ng-disabled="isAddingCoapplicant"
                          ng-click="addCoapplicant()"
                          ng-bind-html="t( 'part1.project_team.addCoapplicant' )"></button>
                </div>
              </fieldset>
            </form>
            <div ng-if="model.viewModel.addingCoapplicantWithData">
              <hr/>
              <p class="text-primary" ng-bind-html="t( 'part1.project_team.coapplicantAgreementText' )"></p>
              <button class="btn btn-default full-width"
                      ng-click="model.viewModel.downloadCoapplicantAgreementTemplate()"
                      ng-bind-html="t( 'part1.project_team.coapplicantAgreementButton' )"></button>
              <fieldset ng-disabled="!liteModel.getEditEnabled() || isDAO()">
                <cn-view-input-with-differences
                  input="{
                    key: 'coapplicant_agreement_filename',
                    title: t( 'part1.project_team.coapplicantAgreement' ),
                    type: 'file'
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.project_team.coapplicant_agreement_filename"
                  model="liteModel">
                </cn-view-input-with-differences>
              </fieldset>
            </div>
          </div>
        </div>
        <div ng-show="'timeline'==model.viewModel.formTab" class="panel panel-default">
          <div class="panel-body">
            <cn-deferral-note ng-if="model.getEditEnabled()" page="timeline"></cn-deferral-note>
            <p class="text-primary" ng-bind-html="t( 'part1.timeline.text1' ) + startDateDelay + t( 'part1.timeline.text2' )"></p>
            <p class="text-primary" ng-bind-html="t( 'part1.timeline.text3' )"></p>
            <p class="text-primary" ng-bind-html="t( 'part1.timeline.text4' )"></p>
            <hr/>
            <form id="timeline_form" name="timeline_form" novalidate><fieldset ng-disabled="!model.getEditEnabled() || isDAO()">
              <div class="form-horizontal">
                <cn-view-input
                  input="{
                    key: 'deadline',
                    title: t( 'part1.timeline.deadline' ),
                    type: 'datetime',
                    constant: true
                  }"
                  ng-if="model.viewModel.record.deadline"
                  difference="model.viewModel.compareRecord.differences.part1.timeline.deadline"
                  model="model">
                </cn-view-input>
                <cn-view-input-with-differences
                  input="{
                    key: 'start_date',
                    title: t( 'part1.timeline.start_date' ),
                    type: model.inputList.start_date.type,
                    min: model.viewModel.minStartDate
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.timeline.start_date"
                  model="model">
                </cn-view-input-with-differences>
                <cn-view-input-with-differences
                  input="{
                    key: 'duration',
                    title: t( 'part1.timeline.duration' ),
                    type: 'enum',
                    enumList: '.' == model.viewModel.record.amendment
                      ? model.metadata.columnList.duration.standardEnumList[model.viewModel.record.lang]
                      : '2' == model.viewModel.record.duration.substr(0,1)
                      ? model.metadata.columnList.duration.amendment2EnumList[model.viewModel.record.lang]
                      : model.metadata.columnList.duration.amendment3EnumList[model.viewModel.record.lang]
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.timeline.duration"
                  model="model">
                </cn-view-input-with-differences>
              </div>
            </fieldset></form>
          </div>
        </div>
        <div ng-show="'description'==model.viewModel.formTab" class="panel panel-default">
          <div class="panel-body">
            <cn-deferral-note ng-if="model.getEditEnabled()" page="description"></cn-deferral-note>
            <p class="text-primary" ng-bind-html="t( 'part1.description.text1' )"></p>
            <hr/>
            <form id="description_form" name="description_form" novalidate><fieldset ng-disabled="!model.getEditEnabled() || isDAO()">
              <div class="form-horizontal">
                <cn-view-input-with-differences
                  input="{
                    key: 'title',
                    title: t( 'part1.description.title' ),
                    type: model.inputList.title.type,
                    isConstant: isTitleConstant
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.description.title"
                  model="model">
                </cn-view-input-with-differences>
                <cn-view-input-with-differences
                  input="{
                    key: 'keywords',
                    title: t( 'part1.description.keywords' ),
                    type: 'string',
                    isConstant: isDescriptionConstant,
                    help: t( 'part1.description.keywords_text' )
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.description.keywords"
                  model="model">
                </cn-view-input-with-differences>
                <p class="text-primary" ng-bind-html="t( 'part1.description.text2' )"></p>
                <cn-view-input-with-differences
                  input="{
                    key: 'lay_summary',
                    title: '<b class=\'invert\'>ⓘ</b> ' + t( 'part1.description.lay_summary' ) + '<br><span class=text-info>(' +
                           model.viewModel.charCount.lay_summary + ' ' + t( 'misc.chars' ) + ')</span>',
                    type: model.inputList.lay_summary.type,
                    isConstant: isDescriptionConstant,
                    maxLength: 1000,
                    help: t( 'part1.description.lay_summary_text' )
                  }"
                  no-help-indicator="true",
                  difference="model.viewModel.compareRecord.differences.part1.description.lay_summary"
                  model="model">
                </cn-view-input-with-differences>
                <hr/>
                <p class="text-primary" ng-bind-html="t( 'part1.description.text3' )"></p>
                <cn-view-input-with-differences
                  input="{
                    key: 'background',
                    title: t( 'part1.description.background' ) + '<br><span class=text-info>(' +
                           model.viewModel.charCount.background + ' ' + t( 'misc.chars' ) + ')</span>',
                    type: model.inputList.background.type,
                    isConstant: isDescriptionConstant,
                    maxLength: 4500
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.description.background"
                  model="model">
                </cn-view-input-with-differences>
                <cn-view-input-with-differences
                  input="{
                    key: 'objectives',
                    title: t( 'part1.description.objectives' ) + '<br><span class=text-info>(' +
                           model.viewModel.charCount.objectives + ' ' + t( 'misc.chars' ) + ')</span>',
                    type: model.inputList.objectives.type,
                    isConstant: isDescriptionConstant,
                    maxLength: 4500
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.description.objectives"
                  model="model">
                </cn-view-input-with-differences>
                <cn-view-input-with-differences
                  input="{
                    key: 'methodology',
                    title: '<b class=\'invert\'>ⓘ</b> ' + t( 'part1.description.methodology' ) + '<br><span class=text-info>(' +
                           model.viewModel.charCount.methodology + ' ' + t( 'misc.chars' ) + ')</span>',
                    type: 'text',
                    isConstant: isDescriptionConstant,
                    maxLength: 4500,
                    help: t( 'part1.description.methodology_text' )
                  }"
                  no-help-indicator="true",
                  difference="model.viewModel.compareRecord.differences.part1.description.methodology"
                  model="model">
                </cn-view-input-with-differences>
                <cn-view-input
                  ng-if="'.' != model.viewModel.record.amendment && 'en' == model.viewModel.record.lang"
                  input="{
                    key: 'justification_summary_en',
                    title: t( 'part1.description.amendment_justification_summary' ),
                    type: 'text',
                    constant: true
                  }"
                  model="model">
                </cn-view-input>
                <cn-view-input
                  ng-if="'.' != model.viewModel.record.amendment && 'fr' == model.viewModel.record.lang"
                  input="{
                    key: 'justification_summary_fr',
                    title: t( 'part1.description.amendment_justification_summary' ),
                    type: 'text',
                    constant: true
                  }"
                  model="model">
                </cn-view-input>
                <cn-view-input-with-differences
                  input="{
                    key: 'analysis',
                    title: '<b class=\'invert\'>ⓘ</b> ' + t( 'part1.description.analysis' ) + '<br><span class=text-info>(' +
                           model.viewModel.charCount.analysis + ' ' + t( 'misc.chars' ) + ')</span>',
                    type: 'text',
                    isConstant: isDescriptionConstant,
                    maxLength: 4500,
                    help: t( 'part1.description.analysis_text' )
                  }"
                  no-help-indicator="true",
                  difference="model.viewModel.compareRecord.differences.part1.description.analysis"
                  model="model">
                </cn-view-input-with-differences>
                <hr/>
                <p class="text-primary" ng-bind-html="t( 'part1.description.text4' ) + maxReferencesPerReqn + t( 'part1.description.text5' )"></p>
                <div class="panel panel-default">
                  <div class="panel-body"
                       ng-class="{ 'bg-warning': 0 < model.viewModel.compareRecord.differences.part1.description.referenceList.length }">
                    <h4 ng-if="0 < model.viewModel.compareRecord.differences.part1.description.referenceList.length">Current Version List</h4>
                    <span ng-show="0 == model.viewModel.record.referenceList.length"
                          ng-bind-html="t( 'part1.description.noReferences' )"></span>
                    <table class="table table-striped" ng-show="0 < model.viewModel.record.referenceList.length">
                      <thead class="bg-info">
                        <tr>
                          <td ng-bind-html="t( 'part1.description.number' )"></td>
                          <td ng-bind-html="t( 'part1.description.reference' )"></td>
                          <td ng-show="model.getEditEnabled() && !isDescriptionConstant() && !isDAO()"></td>
                        </tr>
                      </thead>
                      <tbody>
                        <tr ng-repeat="reference in model.viewModel.record.referenceList | orderBy: 'rank'">
                          <td>
                            <div ng-if="!model.getEditEnabled() || isDescriptionConstant() || isDAO()">
                              {{ reference.rank }}
                            </div>
                            <div class="btn-group" ng-if="model.getEditEnabled() && !isDescriptionConstant() && !isDAO()">
                              <button class="btn btn-info dropdown-toggle" data-toggle="dropdown" type="button">
                                {{ reference.rank }}
                              </button>
                              <ul class="dropdown-menu" role="menu">
                                <li ng-repeat="r in model.viewModel.record.referenceList | orderBy: 'rank'"
                                    ng-class="{ 'active': r.rank == reference.rank }">
                                  <a href="#" ng-click="setReferenceRank( reference.id, r.rank )">
                                    {{ r.rank }}
                                  </a>
                                </li>
                              </ul>
                            </div>
                          </td>
                          <td class="text-left">{{ reference.reference }}</td>
                          <td ng-show="model.getEditEnabled() && !isDescriptionConstant() && !isDAO()">
                            <button class="btn btn-xs btn-danger"
                                    ng-disabled="isDeletingReference.includes( reference.id )"
                                    ng-click="removeReference( reference.id )"
                                    uib-tooltip-html="t( 'misc.remove' )">
                              <i class="glyphicon glyphicon-remove"></i>
                            </button>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                    <div ng-if="0 < model.viewModel.compareRecord.differences.part1.description.referenceList.length">
                      <hr style="border-top-color: gray;"/>
                      <h4>Version {{ model.viewModel.compareRecord.amendment_version }} List</h4>
                      <span ng-show="0 == model.viewModel.compareRecord.referenceList.length"
                            ng-bind-html="t( 'part1.description.noReferences' )"></span>
                      <table class="table table-striped" ng-show="0 < model.viewModel.compareRecord.referenceList.length">
                        <thead class="bg-info">
                          <tr>
                            <td ng-bind-html="t( 'part1.description.number' )"></td>
                            <td ng-bind-html="t( 'part1.description.reference' )"></td>
                          </tr>
                        </thead>
                        <tbody>
                          <tr ng-repeat="reference in model.viewModel.compareRecord.referenceList | orderBy: 'rank'">
                            <td>{{ reference.rank }}</td>
                            <td class="text-left">{{ reference.reference }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
                <div ng-show="model.getEditEnabled() && !isDescriptionConstant() && !isDAO()">
                  <cn-add-input
                    class="col-sm-10"
                    input="{ key: 'reference', title: t( 'part1.description.reference' ), type: 'string' }"
                    record="referenceRecord"
                    model="model.viewModel.referenceModel"
                    first="false">
                  </cn-add-input>
                  <button class="btn btn-primary col-sm-2"
                          ng-disabled="isAddingReference"
                          ng-click="addReference()"
                          ng-bind-html="t( 'part1.description.addReference' )"></button>
                </div>
              </div>
            </fieldset></form>
          </div>
        </div>
        <div ng-show="'scientific_review'==model.viewModel.formTab" class="panel panel-default">
          <div class="panel-body">
            <cn-deferral-note ng-if="model.getEditEnabled()" page="scientific_review"></cn-deferral-note>
            <p class="text-primary" ng-bind-html="t( 'part1.scientific_review.text' )"></p>
            <hr/>
            <form id="scientific_review_form" name="scientific_review_form" novalidate><fieldset ng-disabled="!model.getEditEnabled() || isDAO()">
              <div class="form-horizontal">
                <cn-view-input-with-differences
                  input="{
                    key: 'peer_review',
                    title: t( 'part1.scientific_review.peer_review' ),
                    type: model.inputList.peer_review.type,
                    enumList: model.metadata.yesNoEnumList[model.viewModel.record.lang],
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.scientific_review.peer_review"
                  model="model">
                </cn-view-input-with-differences>
                <fieldset ng-disabled="!liteModel.getEditEnabled() || isDAO()">
                  <cn-view-input-with-differences
                    ng-if="model.viewModel.record.peer_review"
                    input="{
                      key: 'peer_review_filename',
                      title: t( 'part1.scientific_review.peer_review_filename' ),
                      type: 'file'
                    }"
                    difference="model.viewModel.compareRecord.differences.part1.scientific_review.peer_review_filename"
                    model="liteModel">
                  </cn-view-input-with-differences>
                </fieldset>
                <cn-view-input-with-differences
                  input="{
                    key: 'funding',
                    title: t( 'part1.scientific_review.funding' ),
                    type: 'enum',
                    enumList: model.metadata.columnList.funding.enumList[model.viewModel.record.lang]
                  }"
                  difference="model.viewModel.compareRecord.differences.part1.scientific_review.funding"
                  model="model">
                </cn-view-input-with-differences>
                <cn-view-input-with-differences
                  input="{
                    key: 'funding_agency',
                    title: t( 'part1.scientific_review.funding_agency' ),
                    type: model.inputList.funding_agency.type
                  }"
                  ng-if="['yes', 'requested'].includes( model.viewModel.record.funding )"
                  difference="model.viewModel.compareRecord.differences.part1.scientific_review.funding_agency"
                  model="model">
                </cn-view-input-with-differences>
                <cn-view-input-with-differences
                  input="{
                    key: 'grant_number',
                    title: t( 'part1.scientific_review.grant_number' ),
                    type: model.inputList.grant_number.type
                  }"
                  ng-if="['yes', 'requested'].includes( model.viewModel.record.funding )"
                  difference="model.viewModel.compareRecord.differences.part1.scientific_review.grant_number"
                  model="model">
                </cn-view-input-with-differences>
                <fieldset ng-disabled="!liteModel.getEditEnabled() || isDAO()">
                  <cn-view-input-with-differences
                    ng-if="'yes' === model.viewModel.record.funding"
                    input="{
                      key: 'funding_filename',
                      title: t( 'part1.scientific_review.letter' ),
                      type: 'file'
                    }"
                    difference="model.viewModel.compareRecord.differences.part1.scientific_review.funding_filename"
                    model="liteModel">
                  </cn-view-input-with-differences>
                </fieldset>
              </div>
            </fieldset></form>
          </div>
        </div>
        <div ng-show="'ethics'==model.viewModel.formTab" class="panel panel-default">
          <div class="panel-body">
            <cn-deferral-note ng-if="model.getEditEnabled()" page="ethics"></cn-deferral-note>
            <p class="text-primary" ng-bind-html="t( 'part1.ethics.text' )"></p>
            <hr/>
            <form id="ethics_form" name="ethics_form" novalidate>
              <div class="form-horizontal">
                <fieldset ng-disabled="!model.getEditEnabled() || isDAO()">
                  <cn-view-input-with-differences
                    input="{
                      key: 'ethics',
                      title: t( 'part1.ethics.ethics' ),
                      type: 'enum',
                      enumList: model.metadata.columnList.ethics.enumList[model.viewModel.record.lang]
                    }"
                    difference="model.viewModel.compareRecord.differences.part1.ethics.ethics"
                    model="model">
                  </cn-view-input-with-differences>
                  <div ng-if="!model.viewModel.record.has_ethics_approval_list">
                    <cn-view-input-with-differences
                      ng-if="'yes' === model.viewModel.record.ethics"
                      input="{
                        key: 'ethics_date',
                        title: t( 'part1.ethics.expiration' ),
                        type: model.inputList.ethics_date.type
                      }"
                      difference="model.viewModel.compareRecord.differences.part1.ethics.ethics_date"
                      model="model">
                    </cn-view-input-with-differences>
                    <cn-view-input-with-differences
                      ng-if="'no' === model.viewModel.record.ethics"
                      input="{
                        key: 'ethics_date',
                        title: t( 'part1.ethics.response' ),
                        type: model.inputList.ethics_date.type
                      }"
                      difference="model.viewModel.compareRecord.differences.part1.ethics.response"
                      model="model">
                    </cn-view-input-with-differences>
                  </div>
                </fieldset>
                <fieldset ng-if="!model.viewModel.record.has_ethics_approval_list" ng-disabled="!liteModel.getEditEnabled() || isDAO()">
                  <cn-view-input-with-differences
                    ng-if="'yes' === model.viewModel.record.ethics || 'exempt' === model.viewModel.record.ethics"
                    input="{
                      key: 'ethics_filename',
                      title: t( 'part1.ethics.letter' ),
                      type: 'file'
                    }"
                    difference="model.viewModel.compareRecord.differences.part1.ethics.ethics_filename"
                    model="liteModel">
                  </cn-view-input-with-differences>
                </fieldset>
                <div ng-if="model.viewModel.record.has_ethics_approval_list">
                  <div class="panel panel-default">
                    <div class="panel-body">
                      <p class="text-primary" ng-bind-html="t( 'part1.ethics.approvalListNote' )"></p>
                      <table class="table table-striped">
                        <thead class="bg-info">
                          <tr>
                            <td ng-bind-html="t( 'misc.file' )"></td>
                            <td ng-bind-html="t( 'misc.expirationDate' )"></td>
                            <td></td>
                          </tr>
                        </thead>
                        <tbody>
                          <tr ng-repeat="ethicsApproval in model.viewModel.record.ethicsApprovalList">
                            <td><a ng-click="model.viewModel.downloadEthicsApproval( ethicsApproval.id )" style="cursor: pointer;">
                              {{ ethicsApproval.filename }}
                            </a></td>
                            <td>{{ ethicsApproval.date }}</td>
                            <td>
                              <button class="btn btn-xs btn-danger"
                                      ng-if="isRemoveEthicsApprovalAllowed( ethicsApproval.id )"
                                      ng-disabled="isDeletingEthicsApproval.includes( ethicsApproval.id )"
                                      ng-click="removeEthicsApproval( ethicsApproval.id )"
                                      uib-tooltip-html="t( 'misc.remove' )">
                                <i class="glyphicon glyphicon-remove"></i>
                              </button>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <div ng-show="model.viewModel.ethicsApprovalModel.getEditEnabled() && !isDAO()">
                    <button class="btn btn-primary col-sm-2 pull-right"
                            ng-disabled="isAddingEthicsApproval"
                            ng-click="addEthicsApproval()"
                            ng-bind-html="t( 'misc.add' )"></button>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div ng-show="'part2'==model.viewModel.getTabPart()" class="panel panel-default">
      <div class="panel-body" style="padding-bottom: 0px;">
        <h4 style="margin-top: 0; margin-bottom: 1em;" ng-bind-html="t( 'part2.title' )"></h4>
        <ul class="nav nav-tabs">
          <li ng-repeat="tab in model.viewModel.tabList"
              ng-if="'part2' == model.viewModel.getTabPart(tab)"
              ng-class="{'active':tab == model.viewModel.formTab}">
            <a ng-click="model.viewModel.setFormTab(tab)"
               ng-class="{
                 'text-warning flashing':model.getEditEnabled() && (
                   ( 'cohort' == tab && model.viewModel.record.deferral_note_cohort ) ||
                   ( 'indigenous' == tab && model.viewModel.record.deferral_note_indigenous ) ||
                   model.viewModel.record['deferral_note_'+tab]
                 ),
                 'bg-warning': model.viewModel.compareRecord.differences.part2[tab].diff
               }"
               ng-bind-html="t( 'part2.'+tab+'.tab' )"></a>
          </li>
        </ul>
        <div ng-show="'notes'==model.viewModel.formTab" class="panel panel-default" style="border-top-left-radius: 0px;">
          <div class="panel-body" style="padding-bottom: 0px;">
            <ul class="list-group">
              <li class="list-group-item" ng-bind-html="t( 'part2.notes.text1' )"></li>
              <li class="list-group-item" ng-bind-html="t( 'part2.notes.text2' )"></li>
              <li class="list-group-item" ng-bind-html="t( 'part2.notes.text3' )"></li>
              <li class="list-group-item" ng-bind-html="t( 'part2.notes.text4' )"></li>
            </ul>
          </div>
        </div>
        <div ng-show="'cohort'==model.viewModel.formTab" class="panel panel-default" style="border-top-left-radius: 0px;">
          <div class="panel-body" style="padding-bottom: 0px;">
            <form ng-attr-id="cohort_form" ng-attr-name="cohort_form" novalidate>
              <cn-deferral-note ng-if="model.getEditEnabled()" page="cohort"></cn-deferral-note>
              <fieldset ng-disabled="!model.getEditEnabled() || isDAO()">
                <p class="text-primary" ng-bind-html="t( 'part2.cohort.text1' )"></p>
                <div class="form-horizontal">
                  <cn-view-input-with-differences
                    no-cols=true
                    input="{
                      key: 'tracking',
                      title: t( 'part2.cohort.tracking' ),
                      type: model.inputList.tracking.type,
                      enumList: model.metadata.yesNoEnumList[model.viewModel.record.lang],
                      help: t( 'part2.cohort.trackingHelp' )
                    }"
                    difference="model.viewModel.compareRecord.differences.part2.cohort.tracking"
                    model="model">
                  </cn-view-input-with-differences>
                  <cn-view-input-with-differences
                    no-cols=true
                    input="{
                      key: 'comprehensive',
                      title: t( 'part2.cohort.comprehensive' ),
                      type: model.inputList.comprehensive.type,
                      enumList: model.metadata.yesNoEnumList[model.viewModel.record.lang],
                      help: t( 'part2.cohort.comprehensiveHelp' )
                    }"
                    difference="model.viewModel.compareRecord.differences.part2.cohort.comprehensive"
                    model="model">
                  </cn-view-input-with-differences>
                </div>
                <p class="text-primary" ng-bind-html="t( 'part2.cohort.text2' )"></p>
                <hr/>
                <div class="form-horizontal">
                  <cn-view-input-with-differences
                    no-cols=true
                    input="{
                      key: 'longitudinal',
                      title: t( 'part2.cohort.longitudinal' ),
                      type: model.inputList.longitudinal.type,
                      enumList: model.metadata.yesNoEnumList[model.viewModel.record.lang]
                    }"
                    difference="model.viewModel.compareRecord.differences.part2.cohort.longitudinal"
                    model="model">
                  </cn-view-input-with-differences>
                  <cn-view-input-with-differences
                    ng-if="model.viewModel.record.longitudinal"
                    no-cols=true
                    input="{
                      key: 'last_identifier',
                      title: t( 'part2.cohort.last_identifier' ),
                      type: model.inputList.last_identifier.type
                    }"
                    difference="model.viewModel.compareRecord.differences.part2.cohort.last_identifier"
                    model="model">
                  </cn-view-input-with-differences>
                </div>
              </fieldset>
            </form>
          </div>
        </div>
        <div ng-show="'indigenous'==model.viewModel.formTab" class="panel panel-default" style="border-top-left-radius: 0px;">
          <div class="panel-body" style="padding-bottom: 0px;">
            <form ng-attr-id="indigenous_form" ng-attr-name="indigenous_form" novalidate>
              <cn-deferral-note ng-if="model.getEditEnabled()" page="indigenous"></cn-deferral-note>
              <fieldset ng-disabled="!model.getEditEnabled() || isDAO()">
                <p class="text-primary" ng-bind-html="t( 'part2.indigenous.text1' )"></p>

                <div class="form-horizontal">
                  <cn-view-input-with-differences
                    no-cols=true
                    input="{
                      key: 'indigenous_first_nation',
                      title: t( 'part2.indigenous.indigenous_first_nation' ),
                      type: model.inputList.indigenous_first_nation.type,
                      enumList: model.metadata.yesNoEnumList[model.viewModel.record.lang]
                    }"
                    difference="model.viewModel.compareRecord.differences.part2.indigenous.indigenous_first_nation"
                    model="model">
                  </cn-view-input-with-differences>
                  <cn-view-input-with-differences
                    no-cols=true
                    input="{
                      key: 'indigenous_metis',
                      title: t( 'part2.indigenous.indigenous_metis' ),
                      type: model.inputList.indigenous_metis.type,
                      enumList: model.metadata.yesNoEnumList[model.viewModel.record.lang]
                    }"
                    difference="model.viewModel.compareRecord.differences.part2.indigenous.indigenous_metis"
                    model="model">
                  </cn-view-input-with-differences>
                  <cn-view-input-with-differences
                    no-cols=true
                    input="{
                      key: 'indigenous_inuit',
                      title: t( 'part2.indigenous.indigenous_inuit' ),
                      type: model.inputList.indigenous_inuit.type,
                      enumList: model.metadata.yesNoEnumList[model.viewModel.record.lang]
                    }"
                    difference="model.viewModel.compareRecord.differences.part2.indigenous.indigenous_inuit"
                    model="model">
                  </cn-view-input-with-differences>
                </div>
                <div ng-if="
                  model.viewModel.record.indigenous_first_nation ||
                  model.viewModel.record.indigenous_metis ||
                  model.viewModel.record.indigenous_inuit
                ">
                  <p class="text-primary" ng-bind-html="t( 'part2.indigenous.indigenous_description' )"></p>
                  <div class="form-horizontal">
                    <cn-view-input-with-differences
                      no-cols=true
                      input="{
                        key: 'indigenous_description',
                        title: '',
                        type: model.inputList.indigenous_description.type
                      }"
                      difference="model.viewModel.compareRecord.differences.part2.indigenous.indigenous_description"
                      model="model">
                    </cn-view-input-with-differences>
                  </div>
                  <p class="text-primary" ng-bind-html="t( 'part2.indigenous.indigenous_filename' )"></p>
                  <div class="form-horizontal">
                    <cn-view-input-with-differences
                      input="{
                        key: 'indigenous1_filename',
                        title: t( 'misc.file' ) + ' 1',
                        type: 'file'
                      }"
                      difference="model.viewModel.compareRecord.differences.part2.indigenous.indigenous1_filename"
                      model="model">
                    </cn-view-input-with-differences>
                    <div ng-show="
                      model.viewModel.record.indigenous1_filename ||
                      model.viewModel.record.indigenous2_filename
                    ">
                      <div class="form-horizontal">
                        <cn-view-input-with-differences
                          input="{
                            key: 'indigenous2_filename',
                            title: t( 'misc.file' ) + ' 2',
                            type: 'file'
                          }"
                          difference="model.viewModel.compareRecord.differences.part2.indigenous.indigenous2_filename"
                          model="model">
                        </cn-view-input-with-differences>
                      </div>
                    </div>
                    <div ng-show="
                      model.viewModel.record.indigenous2_filename ||
                      model.viewModel.record.indigenous3_filename
                    ">
                      <div class="form-horizontal">
                        <cn-view-input-with-differences
                          input="{
                            key: 'indigenous3_filename',
                            title: t( 'misc.file' ) + ' 3',
                            type: 'file'
                          }"
                          difference="model.viewModel.compareRecord.differences.part2.indigenous.indigenous3_filename"
                          model="model">
                        </cn-view-input-with-differences>
                      </div>
                    </div>
                    <div ng-show="
                      model.viewModel.record.indigenous3_filename ||
                      model.viewModel.record.indigenous4_filename
                    ">
                      <div class="form-horizontal">
                        <cn-view-input-with-differences
                          input="{
                            key: 'indigenous4_filename',
                            title: t( 'misc.file' ) + ' 4',
                            type: 'file'
                          }"
                          difference="model.viewModel.compareRecord.differences.part2.indigenous.indigenous4_filename"
                          model="model">
                        </cn-view-input-with-differences>
                      </div>
                    </div>
                  </div>
                </div>
              </fieldset>
            </form>
          </div>
        </div>
        <div ng-repeat="category in model.categoryList"
             ng-show="category.tabName == model.viewModel.formTab"
             class="panel panel-default">
          <div class="panel-body">
            <form ng-attr-id="{{ category.tabName }}_form" ng-attr-name="{{ category.tabName }}_form" novalidate>
              <cn-deferral-note ng-if="model.getEditEnabled()" page="{{ category.tabName }}">
              </cn-deferral-note>
              <div class="form-horizontal">
                <div ng-if="category.note[model.viewModel.record.lang]">
                  <div ng-bind-html="category.note[model.viewModel.record.lang]"></div>
                  <div class="vertical-spacer"></div>
                </div>
                <table class="table table-hover" ng-if="category.optionList.length">
                  <thead class="bg-info">
                    <tr>
                      <td width="50%"
                          style="vertical-align: middle;"
                          uib-tooltip-html="category.note[model.viewModel.record.lang] | cnNewlines"
                          tooltip-popup-delay="100">
                      </td>
                      <td ng-repeat="studyPhaseCode in category.studyPhaseList"
                          width="{{ 50/category.studyPhaseList.length + '%' }}"
                          style="vertical-align: middle;"
                          ng-bind-html="
                            t( 'misc.study.' + studyPhaseCode[0] ) + (
                              1 < studyPhaseCode.length ? ( ' - ' + t( 'misc.studyPhase.' + studyPhaseCode[1] ) ) : ''
                            )"></td>
                    </tr>
                  </thead>
                  <tbody>
                    <tr ng-repeat-start="option in category.optionList">
                      <td width="50%" data-toggle="collapse" data-target="#accordion{{ option.id }}" style="vertical-align: middle">
                        <a uib-tooltip-html="option.note[model.viewModel.record.lang] | cnNewlines"
                           tooltip-popup-delay="100">
                          <b class="invert" ng-if="option.note[model.viewModel.record.lang]">ⓘ</b>
                          <span style="text-decoration: underline">
                            {{ option.name[model.viewModel.record.lang] }}
                          </span>
                        </a>
                      </td>
                      <td
                          ng-repeat="selection in option.selectionList"
                          ng-style="{ 'width': 50/detailList.length + '%' }"
                          ng-class="{ 'bg-warning': model.viewModel.compareRecord.differences.part2[category.tabName].selectionList.findByProperty( 'id', selection.id ) }">
                        <span ng-if="null != selection.unavailable[model.viewModel.record.lang]"
                              ng-bind-html="selection.unavailable[model.viewModel.record.lang]"></span>
                        <button ng-if="null == selection.unavailable[model.viewModel.record.lang]"
                                class="btn full-width"
                                ng-class="model.viewModel.record.selectionList[selection.id] ? 'btn-success' : 'btn-default'"
                                ng-disabled="!model.getEditEnabled() || isDAO()"
                                ng-click="model.viewModel.toggleSelection( category, option, selection )">
                          <i class="glyphicon glyphicon-ok" ng-if="model.viewModel.record.selectionList[selection.id]"></i>
                          <span style="font-weight: normal"
                                ng-if="!model.viewModel.record.selectionList[selection.id]"
                                ng-bind-html="t( 'misc.clickToSelect' )"></span>
                        </button>
                      </td>
                    </tr>
                    <tr ng-repeat-end style="background: white">
                      <td colspan="100" style="padding: 0;">
                        <div id="accordion{{ option.id }}" class="collapse text-primary text-left">
                          <div ng-repeat="selection in option.selectionList"
                               ng-if="0 < selection.detailList.length ||
                                      ( null == selection.unavailable[model.viewModel.record.lang] && 0 < selection.cost.value )">
                            <div class="col-sm-2 vertical-spacer"
                                 ng-bind-html="t( 'misc.studyPhase.' + selection.studyPhaseCode )"></div>
                            <div class="col-sm-2 vertical-spacer" ng-if="selection.cost[model.viewModel.record.lang]">
                              <span uib-tooltip-html="selection.costCombined ? t( 'misc.costCombined' ) : ''"
                                    tooltip-popup-delay="100">
                                <b class="invert" ng-if="selection.costCombined">ⓘ</b>
                                {{ selection.cost[model.viewModel.record.lang] }}
                              </span>
                            </div>
                            <div class="vertical-spacer"
                                 ng-class="selection.cost[model.viewModel.record.lang] ? 'col-sm-8' : 'col-sm-10'">
                              <span ng-repeat="detail in selection.detailList"
                                    uib-tooltip-html="detail.note[model.viewModel.record.lang] | cnNewlines"
                                    tooltip-popup-delay="100">
                                <b class="invert" ng-if="detail.note[model.viewModel.record.lang]">ⓘ</b>
                                {{ detail.name[model.viewModel.record.lang] }}{{ $last ? '' : ';' }}
                              </span>
                            </div>
                          </div>
                        </div>
                        <div ng-if="option.justification && model.viewModel.isOptionSelected( option )">
                          <cn-view-input-with-differences
                            input="{
                              key: 'data_justification_' + option.id,
                              title: 'Justification',
                              type: 'text',
                              isConstant: isDAO
                            }"
                            difference="model.viewModel.compareRecord.differences.part2[category.tabName].optionJustificationList.findByProperty( 'id', option.id )"
                            model="model">
                          </cn-view-input-with-differences>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <hr ng-if="'Linked Data' == category.name.en || category.comment" />
                <div ng-if="'Linked Data' == category.name.en" class="form-horizontal">
                  <fieldset ng-disabled="!model.getEditEnabled() || isDAO()">
                    <cn-view-input-with-differences
                      no-cols=true
                      input="{
                        key: 'data_sharing_filename',
                        title: t( 'misc.data_sharing' ),
                        type: 'file'
                      }"
                      difference="model.viewModel.compareRecord.differences.part2.linked_data.data_sharing_filename"
                      model="liteModel">
                    </cn-view-input-with-differences>
                  </fieldset>
                  </fieldset>
                </div>
                <cn-view-input-with-differences
                  no-cols=true
                  ng-if="category.comment"
                  input="{
                    key: 'comment_' + category.id,
                    title: t( 'misc.comments' ),
                    isConstant: isDAO,
                    type: 'text'
                  }"
                  difference="model.viewModel.compareRecord.differences.part2[category.tabName].comment"
                  model="model">
                </cn-view-input-with-differences>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div ng-show="'part3'==model.viewModel.getTabPart()" class="panel panel-default">
      <div class="panel-body" style="padding-bottom: 0px;">
        <h4 style="margin-top: 0; margin-bottom: 1em;" ng-bind-html="t( 'part3.title' )"></h4>
        <p class="text-primary" ng-bind-html="t( 'part3.text' )"></p>
      </div>
    </div>
    <div ng-show="'manuscripts'==model.viewModel.getTabPart()" class="panel panel-default">
      <div class="panel-body" style="padding-bottom: 0px;">
        <h4 style="margin-top: 0; margin-bottom: 1em;" ng-bind-html="t( 'manuscripts.title' )"></h4>
        <p class="text-primary" ng-bind-html="t( 'manuscripts.text' )"></p>
        <div class="panel panel-default">
          <div class="panel-body">
            <span ng-show="0 == model.viewModel.manuscriptList.length"
                  ng-bind-html="t( 'manuscripts.manuscript.noManuscripts' )"></span>
            <table class="table table-striped"
                   ng-class="{ 'table-hover': model.viewModel.getManuscriptEditEnabled() }"
                   ng-show="0 < model.viewModel.manuscriptList.length">
              <thead class="bg-info">
                <tr>
                  <td ng-bind-html="t( 'manuscripts.manuscript.title' )"></td>
                  <td ng-bind-html="t( 'manuscripts.manuscript.status' )"></td>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="manuscript in model.viewModel.manuscriptList"
                    ng-click="model.viewModel.getManuscriptEditEnabled() && viewManuscript( manuscript.id )">
                  <td>{{ manuscript.title }}</td>
                  <td>{{ manuscript.status }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <form
          id="manuscript_form"
          name="manuscript_form"
          ng-show="model.viewModel.getManuscriptEditEnabled() && !isDAO()"
          novalidate
        >
          <div class="form-horizontal">
            <cn-add-input
              class="col-sm-10"
              input="{ key: 'title', title: t( 'manuscripts.manuscript.title' ), type: 'string' }"
              record="manuscriptRecord"
              model="model.viewModel.manuscriptModel">
            </cn-add-input>
            <button
              class="btn btn-primary col-sm-2"
              ng-disabled="isAddingManuscript"
              ng-click="addManuscript()"
              ng-bind-html="t( 'manuscripts.manuscript.addManuscript' )"
            ></button>
          </div>
        </form>
      </div>
    </div>
    <div ng-show="'agreement'==model.viewModel.getTabPart()" class="panel panel-default" ng-if="model.viewModel.showAgreement()">
      <div class="panel-body" style="padding-bottom: 0px;">
        <h4 style="margin-top: 0; margin-bottom: 1em;">Agreement Details</h4>
        <form id="agreement_form" name="agreement_form" novalidate><fieldset ng-disabled="!model.getEditEnabled() || isDAO()">
          <div class="form-horizontal">
            <fieldset ng-disabled="!liteModel.getEditEnabled()">
              <div class="row allow-select">
                <label class="control-label col-sm-3">Changes since last agreement</label>
                <div class="row col-sm-9 form-text vertical-spacer">
                  <div ng-if="0 == model.viewModel.agreementDifferenceList.length">None</div>
                  <ul style="padding-left: 1em;" ng-if=" 0 < model.viewModel.agreementDifferenceList.length">
                    <li ng-repeat="difference in model.viewModel.agreementDifferenceList">{{
                      ( difference.type ? difference.type + ' ' : '' ) +
                      '"' + difference.name + '" has been ' + ( difference.diff ?
                        difference.diff :
                        'changed' + ( null != difference.old ? ' from ' + difference.old : '' ) + ' to ' + difference.new
                      )
                    }}</li>
                  </ul>
                </div>
              </div>
              <div class="row">
                <label class="control-label col-sm-3">Co-Applicant Agreement Forms</label>
                <div class="row col-sm-9 form-text vertical-spacer">
                  <div ng-if="0 == model.viewModel.coapplicantAgreementList.length">None</div>
                  <ul style="padding-left: 1em;" ng-if=" 0 < model.viewModel.coapplicantAgreementList.length">
                    <li ng-repeat="form in model.viewModel.coapplicantAgreementList">
                      <a ng-click="model.viewModel.downloadCoapplicantAgreement( form.id )"
                         style="cursor: pointer;">Version {{ form.version }}</a>
                    </li>
                  </ul>
                </div>
              </div>
              <cn-view-input-with-differences
                input="{
                  key: 'data_agreement_id',
                  title: 'Master Data Agreement',
                  type: 'enum',
                  enumList: model.metadata.columnList.data_agreement_id.enumList,
                  isIncluded: isDataAgreementIncluded
                }"
                model="model">
              </cn-view-input-with-differences>
              <cn-view-input-with-differences
                input="{
                  key: 'agreement_filename',
                  title: 'Agreement File',
                  type: 'file'
                }"
                model="liteModel">
              </cn-view-input-with-differences>
              <cn-view-input-with-differences
                input="{
                  key: 'agreement_start_date',
                  title: 'Agreement Start Date',
                  type: model.inputList.agreement_start_date.type
                }"
                model="model">
              </cn-view-input-with-differences>
              <cn-view-input-with-differences
                input="{
                  key: 'agreement_end_date',
                  title: 'Agreement End Date',
                  type: model.inputList.agreement_end_date.type
                }"
                model="model">
              </cn-view-input-with-differences>
            </fieldset>
          </div>
        </fieldset></form>
      </div>
    </div>
  </div>
  <div class="form-footer text-right rounded-bottom bg-info" style="height:4.6em;">
    <button class="btn btn-primary pull-left"
            ng-if="'instructions' != model.viewModel.getTabPart()"
            ng-click="model.viewModel.nextTab( true )"
            ng-bind-html="'<i class=\'glyphicon glyphicon-arrow-left\'></i> ' + t( 'misc.prevButton' )">
    </button>
    <button class="btn btn-primary"
            ng-if="'part3' != model.viewModel.getTabPart()"
            ng-click="model.viewModel.nextTab( false )"
            ng-bind-html="t( 'misc.nextButton' ) + ' <i class=\'glyphicon glyphicon-arrow-right\'></i>'">
    </button>
  </div>
</div>
